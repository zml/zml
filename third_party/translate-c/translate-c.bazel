load("@rules_zig//zig:defs.bzl", "zig_binary", "zig_configure_binary", "zig_library")

zig_library(
    name = "c_builtins",
    main = "lib/c_builtins.zig",
    visibility = ["//visibility:public"],
)

zig_library(
    name = "helpers",
    main = "lib/helpers.zig",
    visibility = ["//visibility:public"],
)

zig_binary(
    name = "translate-c_raw",
    srcs = glob(["src/**/*.zig"]),
    main = "src/main.zig",
    linkopts = ["-lc"],
    visibility = ["//visibility:public"],
    deps = [
        ":c_builtins",
        ":helpers",
        "@arocc//:aro",
    ],
)

zig_configure_binary(
    name = "translate-c",
    actual = ":translate-c_raw",
    no_translate_c = 1,
    use_cc_common_link = 0,
    visibility = ["//visibility:public"],
)
